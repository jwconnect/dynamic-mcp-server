<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic MCP Server - Advanced Admin UI</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <!-- 헤더 -->
      <header class="header">
        <h1>🚀 Dynamic MCP Server</h1>
        <p class="subtitle">고급 MCP 서버 관리 대시보드</p>
      </header>

      <!-- 상태 카드 -->
      <section class="status-section">
        <div class="card status-card">
          <h2>📊 서버 상태</h2>
          <div id="status-content" class="status-content">
            <div class="status-item">
              <span class="label">상태:</span>
              <span id="server-status" class="value">로딩 중...</span>
            </div>
            <div class="status-item">
              <span class="label">가동 시간:</span>
              <span id="server-uptime" class="value">-</span>
            </div>
            <div class="status-item">
              <span class="label">활성 서버:</span>
              <span id="active-servers" class="value">-</span>
            </div>
            <div class="status-item">
              <span class="label">전체 핸들러:</span>
              <span id="total-handlers" class="value">-</span>
            </div>
          </div>
          <button id="refresh-status-btn" class="btn btn-secondary">
            🔄 새로고침
          </button>
        </div>
      </section>

      <!-- 탭 네비게이션 -->
      <nav class="tabs">
        <button class="tab-btn active" data-tab="servers">🖥️ 서버 관리</button>
        <button class="tab-btn" data-tab="handlers">🔧 핸들러 관리</button>
        <button class="tab-btn" data-tab="config">⚙️ 설정 편집</button>
        <button class="tab-btn" data-tab="logs">📝 로그</button>
        <button class="tab-btn" data-tab="docs">📖 문서</button>
      </nav>

      <!-- 서버 관리 탭 -->
      <section id="servers-tab" class="tab-content active">
        <div class="card">
          <div class="card-header">
            <h2>🖥️ MCP 서버 관리</h2>
            <button id="create-server-btn" class="btn btn-primary">
              ➕ 새 서버 생성
            </button>
          </div>
          
          <div id="servers-container" class="servers-container">
            <p class="placeholder">서버 목록을 불러오는 중...</p>
          </div>
        </div>
      </section>

      <!-- 핸들러 관리 탭 -->
      <section id="handlers-tab" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h2>🔧 핸들러 관리</h2>
            <div class="button-group">
              <button id="scan-handlers-btn" class="btn btn-primary">
                🔍 핸들러 스캔
              </button>
              <select id="group-by-select" class="select">
                <option value="file">파일별 그룹화</option>
                <option value="category">카테고리별 그룹화</option>
                <option value="none">그룹화 안 함</option>
              </select>
            </div>
          </div>

          <!-- 핸들러 풀 (드래그 소스) -->
          <div class="handlers-pool">
            <h3>📦 사용 가능한 핸들러</h3>
            <div id="handlers-list" class="handlers-list">
              <p class="placeholder">핸들러를 스캔하려면 "핸들러 스캔" 버튼을 클릭하세요</p>
            </div>
          </div>

          <!-- 서버별 핸들러 할당 영역 -->
          <div class="servers-assignment">
            <h3>🎯 서버별 핸들러 할당</h3>
            <div id="servers-dropzones" class="servers-dropzones">
              <p class="placeholder">서버 목록을 불러오는 중...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 설정 편집 탭 -->
      <section id="config-tab" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h2>⚙️ 설정 파일 (config.json)</h2>
            <div class="button-group">
              <button id="load-config-btn" class="btn btn-secondary">
                📥 불러오기
              </button>
              <button id="save-config-btn" class="btn btn-primary">
                💾 저장하기
              </button>
            </div>
          </div>
          <textarea
            id="config-editor"
            class="config-editor"
            placeholder="설정 파일을 불러오는 중..."
          ></textarea>
          <div class="help-text">
            💡 설정을 수정한 후 "저장하기" 버튼을 클릭하면 서버가 자동으로
            재로딩됩니다.
          </div>
        </div>
      </section>

      <!-- 로그 뷰어 탭 -->
      <section id="logs-tab" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h2>📝 서버 로그</h2>
            <div class="button-group">
              <select id="log-type-select" class="select">
                <option value="combined">전체 로그</option>
                <option value="error">에러 로그</option>
              </select>
              <button id="refresh-logs-btn" class="btn btn-secondary">
                🔄 새로고침
              </button>
              <button id="clear-logs-btn" class="btn btn-danger">
                🗑️ 로그 삭제
              </button>
            </div>
          </div>
          <div id="logs-container" class="logs-container">
            <p class="placeholder">로그를 불러오는 중...</p>
          </div>
        </div>
      </section>

      <!-- 문서 탭 -->
      <section id="docs-tab" class="tab-content">
        <div class="card">
          <h2>📖 사용 가이드</h2>

          <h3>🔌 MCP 클라이언트 연결 방법</h3>

          <h4>1. Claude Desktop</h4>
          <p>
            <code>~/Library/Application Support/Claude/claude_desktop_config.json</code> 파일에 다음 설정을 추가하세요:
          </p>
          <pre><code>{
  "mcpServers": {
    "dynamic-mcp": {
      "url": "http://localhost:3000/mcp",
      "transport": "http"
    }
  }
}</code></pre>

          <h4>2. 핸들러 관리 방법</h4>
          <ul>
            <li><strong>핸들러 스캔</strong>: "핸들러 관리" 탭에서 "핸들러 스캔" 버튼 클릭</li>
            <li><strong>드래그 앤 드롭</strong>: 핸들러를 드래그하여 원하는 서버로 이동</li>
            <li><strong>사용 여부 토글</strong>: 체크박스로 핸들러 활성화/비활성화</li>
            <li><strong>테스트 실행</strong>: "테스트" 버튼으로 핸들러 동작 확인</li>
          </ul>

          <h4>3. 멀티 서버 관리</h4>
          <ul>
            <li><strong>서버 생성</strong>: "서버 관리" 탭에서 "새 서버 생성" 버튼 클릭</li>
            <li><strong>서버 편집</strong>: 서버 카드의 "편집" 버튼 클릭</li>
            <li><strong>서버 삭제</strong>: 서버 카드의 "삭제" 버튼 클릭</li>
            <li><strong>활성화/비활성화</strong>: 토글 스위치로 서버 제어</li>
          </ul>

          <h4>4. 커스텀 핸들러 작성</h4>
          <p>
            <code>server/handlers/</code> 디렉토리에 새로운 핸들러 파일을
            작성하세요:
          </p>
          <pre><code>/**
 * @title 내 함수
 * @description 함수 설명
 * @category my-category
 */
export async function myFunction({ param1, param2 }) {
  return {
    result: param1 + param2
  };
}</code></pre>
        </div>
      </section>

      <!-- 푸터 -->
      <footer class="footer">
        <p>
          Made with ❤️ by
          <a href="https://github.com/jwconnect/dynamic-mcp-server" target="_blank">Manus AI</a>
        </p>
      </footer>
    </div>

    <!-- 모달: 서버 생성/편집 -->
    <div id="server-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="server-modal-title">새 서버 생성</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="server-name">서버 이름</label>
            <input type="text" id="server-name" class="input" placeholder="예: calculator-server" />
          </div>
          <div class="form-group">
            <label for="server-version">버전</label>
            <input type="text" id="server-version" class="input" placeholder="1.0.0" value="1.0.0" />
          </div>
          <div class="form-group">
            <label for="server-description">설명</label>
            <textarea id="server-description" class="input" rows="3" placeholder="서버 설명을 입력하세요"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="server-modal-cancel" class="btn btn-secondary">취소</button>
          <button id="server-modal-save" class="btn btn-primary">저장</button>
        </div>
      </div>
    </div>

    <!-- 모달: 핸들러 테스트 -->
    <div id="test-modal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h3 id="test-modal-title">핸들러 테스트</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>입력 스키마 (읽기 전용)</label>
            <textarea id="test-schema" class="input schema-readonly" rows="6" readonly></textarea>
          </div>
          <div class="form-group">
            <label>테스트 파라미터 (JSON)</label>
            <textarea id="test-params" class="input" rows="4" placeholder='{"a": 5, "b": 3}'></textarea>
          </div>
          <div class="form-group">
            <label>실행 결과</label>
            <pre id="test-result" class="test-result">테스트를 실행하려면 "실행" 버튼을 클릭하세요</pre>
          </div>
        </div>
        <div class="modal-footer">
          <button id="test-modal-close" class="btn btn-secondary">닫기</button>
          <button id="test-modal-run" class="btn btn-primary">▶ 실행</button>
        </div>
      </div>
    </div>

    <!-- 알림 토스트 -->
    <div id="toast" class="toast"></div>

    <script src="app.js"></script>
  </body>
</html>
