# 동적 MCP 서버 시스템 - 요구사항 분석

## 1. 프로젝트 개요

**Node 기반의 동적 MCP(Model Context Protocol) 서버 시스템**을 구축하여, 하나의 고정된 URL과 포트를 유지하면서도 JSON 설정 파일을 통해 다양한 기능을 동적으로 추가/제거/수정할 수 있는 유연한 아키텍처를 제공한다.

## 2. 핵심 요구사항

### 2.1 동적 기능 관리
- **JSON 설정 파일 기반**: MCP 서버 이름과 기능(tools, resources, prompts) 목록을 JSON 파일로 정의
- **핫 리로딩**: 설정 파일 변경 시 서버 재시작 없이 기능 동적 업데이트
- **멀티 프로파일**: 하나의 서버에서 여러 MCP 서버 프로파일을 동시에 관리

### 2.2 서버 아키텍처
- **고정 URL/포트**: 일관된 엔드포인트 제공 (예: `http://localhost:3000/mcp`)
- **멀티스레드 지원**: 동시 다발적인 요청 처리 능력
- **Transport 지원**: STDIO 및 HTTP(Streamable HTTP) 방식 모두 지원
- **Nodemon 통합**: 개발 시 자동 재시작 기능

### 2.3 클라이언트 호환성
다음 MCP 클라이언트들과 호환되어야 함:
- **Claude Desktop**: `claude_desktop_config.json` 설정 지원
- **Claude Code**: CLI를 통한 MCP 서버 등록
- **VS Code**: MCP 확장 프로그램 연동
- **Cursor**: MCP 서버 통합
- **Roo Code**: MCP 프로토콜 지원
- **GitHub Copilot**: MCP 서버 연결 (가능한 경우)

### 2.4 관리 GUI
- **웹 기반 프론트엔드**: 설정 파일을 시각적으로 관리
- **실시간 모니터링**: 서버 상태, 활성 기능, 요청 로그 확인
- **기능 편집기**: Tools, Resources, Prompts를 GUI에서 추가/수정/삭제
- **설정 내보내기/가져오기**: JSON 설정 파일 업로드/다운로드

## 3. MCP 프로토콜 이해

### 3.1 MCP 서버의 세 가지 주요 기능

#### Tools (도구)
- LLM이 실행할 수 있는 함수/작업
- 계산, 데이터 조회, 외부 API 호출 등
- 입력 스키마와 출력 스키마 정의 필요
- **예시**: 날씨 조회, 계산기, 파일 검색

#### Resources (리소스)
- LLM이 읽을 수 있는 데이터/파일
- 정적 또는 동적 콘텐츠 제공
- URI 기반 접근
- **예시**: 문서, 데이터베이스 레코드, API 응답

#### Prompts (프롬프트)
- 사전 정의된 프롬프트 템플릿
- 특정 작업을 위한 가이드 제공
- 매개변수화 가능
- **예시**: 코드 리뷰 템플릿, 문서 작성 가이드

### 3.2 통신 방식

#### STDIO Transport
- 표준 입출력을 통한 JSON-RPC 통신
- Claude Desktop 등에서 주로 사용
- 프로세스 기반 실행

#### HTTP Transport (Streamable HTTP)
- HTTP POST 요청을 통한 통신
- 웹 기반 클라이언트에 적합
- 세션 관리 필요

## 4. 기술 가능성 분석

### 4.1 동적 기능 로딩 가능성
✅ **가능함** - Node.js의 동적 특성을 활용하여 런타임에 기능 추가/제거 가능

**구현 방법**:
1. JSON 설정 파일 파싱
2. 설정에 따라 `server.registerTool()`, `server.registerResource()` 동적 호출
3. 파일 감시(watch)를 통한 변경 감지 및 재로딩

### 4.2 고정 URL/포트에서 다중 기능 제공
✅ **가능함** - 하나의 HTTP 서버에서 여러 MCP 서버 인스턴스 관리 가능

**구현 방법**:
1. Express 서버에서 고정 포트 리스닝
2. 요청 헤더 또는 경로 파라미터로 서버 프로파일 식별
3. 각 프로파일별로 독립적인 MCP 서버 인스턴스 유지

### 4.3 멀티스레드 처리
✅ **가능함** - Node.js의 비동기 이벤트 루프와 Worker Threads 활용

**구현 방법**:
1. 기본적으로 Node.js의 비동기 I/O 활용 (단일 스레드, 다중 동시 처리)
2. CPU 집약적 작업은 Worker Threads로 분리
3. 클러스터 모드로 여러 프로세스 실행 (선택적)

## 5. 시스템 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────┐
│                     클라이언트 레이어                          │
│  Claude Desktop │ VS Code │ Cursor │ Claude Code │ Web UI   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   HTTP 서버 (Express)                        │
│                  Port: 3000 (고정)                           │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                  동적 MCP 서버 관리자                         │
│  - 설정 파일 로더                                             │
│  - 핫 리로딩 엔진                                             │
│  - 서버 인스턴스 관리                                         │
└─────────────────────────────────────────────────────────────┘
                            │
                ┌───────────┼───────────┐
                ▼           ▼           ▼
        ┌──────────┐ ┌──────────┐ ┌──────────┐
        │ MCP 서버 1│ │ MCP 서버 2│ │ MCP 서버 N│
        │ (날씨)   │ │ (계산기)  │ │ (커스텀) │
        └──────────┘ └──────────┘ └──────────┘
                            │
                            ▼
                ┌───────────────────────┐
                │   config.json         │
                │   (설정 파일)         │
                └───────────────────────┘
```

## 6. 주요 컴포넌트

### 6.1 백엔드 컴포넌트
1. **HTTP 서버** (Express + Streamable HTTP Transport)
2. **MCP 서버 매니저** (동적 인스턴스 관리)
3. **설정 로더** (JSON 파싱 및 검증)
4. **핫 리로더** (파일 감시 및 재로딩)
5. **로깅 시스템** (요청/응답 추적)

### 6.2 프론트엔드 컴포넌트
1. **대시보드** (서버 상태 모니터링)
2. **설정 에디터** (JSON 편집 UI)
3. **기능 관리자** (Tools/Resources/Prompts CRUD)
4. **로그 뷰어** (실시간 로그 표시)
5. **테스트 콘솔** (기능 테스트 인터페이스)

## 7. 데이터 모델

### 7.1 설정 파일 구조 (config.json)
```json
{
  "servers": [
    {
      "name": "weather-server",
      "version": "1.0.0",
      "description": "날씨 정보 제공 서버",
      "enabled": true,
      "tools": [
        {
          "name": "get-weather",
          "title": "날씨 조회",
          "description": "도시별 현재 날씨 조회",
          "inputSchema": {
            "city": { "type": "string", "description": "도시 이름" }
          },
          "handler": "handlers/weather.js",
          "function": "getWeather"
        }
      ],
      "resources": [],
      "prompts": []
    }
  ],
  "server": {
    "port": 3000,
    "host": "localhost",
    "enableCors": true
  }
}
```

## 8. 개발 단계

### Phase 1: 분석 및 설계 ✅
- MCP 프로토콜 이해
- 요구사항 정의
- 아키텍처 설계

### Phase 2: 백엔드 구현
- Express 서버 설정
- MCP SDK 통합
- 동적 로딩 시스템 구현
- 설정 파일 관리

### Phase 3: 프론트엔드 구현
- React/Vue 기반 관리 UI
- 설정 편집 인터페이스
- 모니터링 대시보드

### Phase 4: 통합 테스트
- 각 클라이언트별 연동 테스트
- 부하 테스트
- 핫 리로딩 검증

### Phase 5: 문서화 및 배포
- README 작성
- API 문서화
- GitHub 리포지토리 생성 및 업로드

## 9. 기대 효과

### 9.1 유연성
- 코드 수정 없이 기능 추가/변경 가능
- 여러 용도로 재사용 가능한 범용 MCP 서버

### 9.2 생산성
- GUI를 통한 직관적인 관리
- 빠른 프로토타이핑 및 테스트

### 9.3 확장성
- 플러그인 아키텍처로 무한 확장 가능
- 커뮤니티 기여를 통한 핸들러 라이브러리 구축

### 9.4 호환성
- 모든 주요 MCP 클라이언트와 호환
- 표준 프로토콜 준수

## 10. 결론

**동적 MCP 서버 시스템은 기술적으로 완전히 구현 가능하며**, Node.js의 동적 특성과 MCP TypeScript SDK를 활용하여 고정된 URL/포트에서 다양한 기능을 동적으로 제공할 수 있다. JSON 설정 파일을 통한 선언적 구성과 웹 기반 관리 GUI를 결합하여 개발자 친화적이고 확장 가능한 솔루션을 제공할 수 있다.
